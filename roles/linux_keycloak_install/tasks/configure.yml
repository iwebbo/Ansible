---
# tasks/configure.yml - TÃ¢ches de configuration de Keycloak

- name: Create configuration directories
  file:
    path: "/opt/keycloak/{{ item }}"
    state: directory
    owner: keycloak
    group: keycloak
    mode: '0750'
  loop:
    - "conf"
    - "data"
    - "logs"
  tags:
    - configure
    - directories

- name: Generate initial Keycloak configuration
  template:
    src: keycloak.conf.j2
    dest: /opt/keycloak/conf/keycloak.conf
    owner: keycloak
    group: keycloak
    mode: '0640'
  notify: Restart Keycloak service
  tags:
    - configure
    - config

# - name: Configure firewall rules
#   ufw:
#     rule: allow
#     port: "{{ item }}"
#     proto: tcp
#   loop:
#     - 8080   # HTTP (Development)
#     - 8443   # HTTPS (Production)
#   when: keycloak_configure_firewall | default(true)
#   tags:
#     - configure
#     - firewall